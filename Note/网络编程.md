# 前言
我对于网络编程一直以来都是处于一知半解的状态，以至于当我想编写这个网络通讯模块的时候，我是抓瞎的😶，我不知道我要写什么功能，怎么写。
于是，我利用AI解决了我大部分的疑惑，并写下此篇笔记😭

# 网络通讯的流程
这里将TCP和UDP分开进行说明，同时分为服务端（Server）和客户端（Client）。

## TCP
- Server流程：
    1. 创建监听socket
    2. 使用bind将IP和端口等信息进行绑定
    3. 使用listen对backlog进行设置，初始化SYN和Accept队列，使socket进行被动监听状态
    4. 使用accept，从Accpet队列中取出一个已建立的连接，与客户端进行通信，返回的是一个文件描述符，借此来和client进行交流
    5. 使用send/recv与客户端进行通信
    6. 使用close关闭通信socket
    7. 使用close关闭监听socket

- Client流程：
    1. 创建通信socket
    2. 使用connect，触发TCP三次握手，建立TCP连接
        - 发送SYN -> 接收SYN+SCK -> 发送ACK
    3. 连接成功后，使用send/recv与服务端进行通信
    4. 使用close，触发四次挥手，释放连接资源
        - 发送FIN -> 接收ACK -> 发送FIN -> 接收ACK

## UDP

## 内核细节说明
若是在写代码的时候会稍微思考一下，很容易就会产生疑惑：我们都知道三次握手四次挥手，但是其中的核心逻辑在内核中是如何实现的？大家也都知道调用SYS API，但是它们背后都做了些什么事？这都是我所好奇的。

### 连接是如何建立的？
首先，在服务端中，会先使用bind和listen使得至少一个文件描述符能够进入监听状态，监听设备的网络状态。在使用listen之后，内核会创建两个**队列**：SYN队列和ACK队列。